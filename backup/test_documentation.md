# パートナー要員管理システム テスト実装ドキュメント

## 1. 概要

このドキュメントでは、パートナー要員管理システムの各種テスト実装について説明します。テストは以下のカテゴリに分類されます：

1. **バックエンドユニットテスト**: NestJSのコントローラーとサービスに対するユニットテスト
2. **バックエンド統合テスト**: ユーザーストーリーに基づいた統合テスト
3. **フロントエンドユニットテスト**: Reactコンポーネントに対するユニットテスト
4. **E2Eテスト (Cypress)**: ブラウザを使用した実際のユーザー操作をシミュレートするテスト

## 2. バックエンドテスト

### 2.1 ユニットテスト

バックエンドのユニットテストは、各モジュールのコントローラーとサービスに対して実装されています。

#### 2.1.1 コントローラーテスト

| テストファイル | 対象コンポーネント | テスト内容 |
|--------------|-----------------|----------|
| `contracts.controller.spec.ts` | 契約コントローラー | 契約の作成、取得、更新、削除API |
| `partners.controller.spec.ts` | パートナーコントローラー | パートナー企業の作成、取得、更新、削除API |
| `projects.controller.spec.ts` | 案件コントローラー | 案件の作成、取得、更新、削除API |
| `staff.controller.spec.ts` | 要員コントローラー | 要員の作成、取得、更新、削除API |

#### 2.1.2 サービステスト

| テストファイル | 対象コンポーネント | テスト内容 |
|--------------|-----------------|----------|
| `contracts.service.spec.ts` | 契約サービス | 契約の作成、取得、更新、削除ロジック |
| `partners.service.spec.ts` | パートナーサービス | パートナー企業の作成、取得、更新、削除ロジック |
| `projects.service.spec.ts` | 案件サービス | 案件の作成、取得、更新、削除ロジック |
| `staff.service.spec.ts` | 要員サービス | 要員の作成、取得、更新、削除ロジック |

#### 2.1.3 その他のテスト

| テストファイル | 対象コンポーネント | テスト内容 |
|--------------|-----------------|----------|
| `app.controller.spec.ts` | アプリケーションコントローラー | ヘルスチェックエンドポイント |
| `validation.spec.ts` | バリデーション | 入力データのバリデーションロジック |

### 2.2 統合テスト

バックエンドの統合テストは、ユーザーストーリーに基づいたシナリオをテストします。

#### 2.2.1 ユーザーストーリーテスト

| テストファイル | テスト内容 |
|--------------|----------|
| `user-story.spec.ts` | 4つのユーザーストーリーに基づいたシナリオテスト |

**ユーザーストーリー1: パートナー管理**
- 管理者としてログインできること
- パートナー企業を登録できること
- パートナー企業の一覧を取得できること
- パートナー企業の情報を更新できること

**ユーザーストーリー2: プロジェクトと要員のアサイン**
- 新規プロジェクトを作成できること
- パートナー企業の要員を登録できること
- プロジェクトに要員をアサインできること（契約作成）
- プロジェクトの要員一覧を取得できること

**ユーザーストーリー3: 契約管理**
- 契約内容を更新できること
- 契約を終了できること

**ユーザーストーリー4: レポートと分析**
- パートナー企業ごとの要員数を集計できること
- プロジェクトの予算と実績を比較できること

## 3. フロントエンドテスト

### 3.1 ユニットテスト

フロントエンドのユニットテストは、Reactコンポーネントに対して実装されています。

| テストファイル | 対象コンポーネント | テスト内容 |
|--------------|-----------------|----------|
| `App.test.tsx` | Appコンポーネント | メインアプリケーションコンポーネントのレンダリング |

## 4. E2Eテスト (Cypress)

### 4.1 CRUD操作テスト

各機能のCRUD（作成、読み取り、更新、削除）操作をテストします。

| テストファイル | テスト内容 |
|--------------|----------|
| `partner_crud.spec.js` | パートナー企業のCRUD操作 |
| `antisocial_check_crud.spec.js` | 反社チェックのCRUD操作 |
| `base_contract_crud.spec.js` | 基本契約のCRUD操作 |
| `contact_person_crud.spec.js` | 窓口担当者のCRUD操作 |
| `project_crud.spec.js` | 案件のCRUD操作 |
| `staff_crud.spec.js` | 要員のCRUD操作 |
| `contract_crud.spec.js` | 個別契約のCRUD操作 |

### 4.2 機能テスト

各機能の特定の動作をテストします。

| テストファイル | テスト内容 |
|--------------|----------|
| `auth.spec.js` | 認証機能（ログイン、ログアウト） |
| `dashboard.spec.js` | ダッシュボード機能とナビゲーション |

### 4.3 ユーザーストーリーE2Eテスト

複数の画面を跨いだ一連の操作をテストします。

| テストファイル | テスト内容 |
|--------------|----------|
| `user_story_partner_project_flow.spec.js` | パートナー企業登録から案件アサインまでの一連の流れ |
| `user_story_contract_management.spec.js` | 契約の作成から更新、終了までの一連の流れ |

## 5. テスト実行方法

### 5.1 バックエンドテスト

```bash
cd /home/ubuntu/PMS/backend
npm run test        # ユニットテスト実行
npm run test:e2e    # E2Eテスト実行
npm run test:cov    # カバレッジレポート付きテスト実行
```

### 5.2 フロントエンドテスト

```bash
cd /home/ubuntu/PMS/frontend
npm run test        # Reactコンポーネントテスト実行
```

### 5.3 Cypressテスト

```bash
cd /home/ubuntu/PMS/frontend
npx cypress open    # Cypressを対話モードで実行
npx cypress run     # Cypressをヘッドレスモードで実行
```

## 6. テスト網羅性分析

### 6.1 バックエンドテスト網羅性

| モジュール | ユニットテスト | 統合テスト | 網羅率 |
|----------|--------------|-----------|-------|
| 認証 | ✅ | ✅ | 高 |
| パートナー管理 | ✅ | ✅ | 高 |
| 案件管理 | ✅ | ✅ | 高 |
| 要員管理 | ✅ | ✅ | 高 |
| 契約管理 | ✅ | ✅ | 高 |

### 6.2 フロントエンドテスト網羅性

| コンポーネント | ユニットテスト | E2Eテスト | 網羅率 |
|--------------|--------------|----------|-------|
| 認証 | ❌ | ✅ | 中 |
| ダッシュボード | ❌ | ✅ | 中 |
| パートナー管理 | ❌ | ✅ | 中 |
| 案件管理 | ❌ | ✅ | 中 |
| 要員管理 | ❌ | ✅ | 中 |
| 契約管理 | ❌ | ✅ | 中 |

### 6.3 E2Eテスト網羅性

| ユースケース | テスト実装 | 網羅率 |
|------------|-----------|-------|
| 認証フロー | ✅ | 高 |
| パートナー管理フロー | ✅ | 高 |
| 案件管理フロー | ✅ | 高 |
| 要員管理フロー | ✅ | 高 |
| 契約管理フロー | ✅ | 高 |
| 画面間連携 | ✅ | 高 |

## 7. 改善点と推奨事項

1. **フロントエンドユニットテストの強化**
   - 各Reactコンポーネントに対するユニットテストを追加
   - フォームバリデーションのテストを追加

2. **APIエラーハンドリングのテスト強化**
   - エラー状態のテストケースを追加
   - ネットワークエラーのシミュレーションテストを追加

3. **パフォーマンステストの追加**
   - 大量データ処理時のパフォーマンステスト
   - ページロード時間の測定テスト

4. **セキュリティテストの追加**
   - CSRF対策のテスト
   - 権限チェックのテスト

5. **テスト自動化の強化**
   - CI/CDパイプラインへのテスト統合
   - テスト結果レポートの自動生成
